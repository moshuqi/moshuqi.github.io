---
layout: post
title:  云服务器搭建git仓库
category: "git"
---

安装 OpenSSH Server
sudo apt-get install openssh-server

查看服务器ip地址

![image1](/images/posts/CreateGit/1.jpg)

本地ping一下服务器确认能否ping通

![image2](/images/posts/CreateGit/2.jpg)

通过ssh hd为服务器用户名

	ssh hd@172.16.202.129
	
若是自己的服务器有可能出现ssh连接失败，那是因为没有安装 OpenSSH Server 	
	
![image3](/images/posts/CreateGit/3.jpg)

在服务器命令安装 OpenSSH Server

	sudo apt-get install openssh-server
	
安装完成后，在本地命令行再次尝试ssh登录，输入用户名密码，登录成功后显示

![image4](/images/posts/CreateGit/4.jpg)

服务器安装git

	sudo apt-get install git

查看git是否成功安装

![image5](/images/posts/CreateGit/5.jpg)

创建一个git用户，用来运行git服务

sudo adduser git

输入git的密码，然后默认一路敲回车

![image6](/images/posts/CreateGit/6.jpg)

此时便在服务器创建了git用户

我们可以尝试先退出hd用户，换成git登录

![image7](/images/posts/CreateGit/7.jpg)

登录成功后的用户为git

切换回之前的hd用户

创建正书登录

在 /home/git/ 目录下创建 .ssh文件夹
	
	sudo mkdir .ssh
	
在.ssh文件夹中创建authorized_keys文件

将本地的id_rsa.pub 内容保存到authorized_keys文件中

![image8](/images/posts/CreateGit/8.jpg)

初始化Git仓库

选定一个目录作为仓库，在/srv目录下创建git目录，以后所有的仓库都保存在这个目录下


在/srv/git目录下输入命令创建一个裸仓库

	sudo git init --bare demo.git

服务器上的仓库通常都以.git结尾，然后把owner改为git

	sudo chown -R git:git demo.git/
	
![image9](/images/posts/CreateGit/9.jpg)	


禁用ssh登录

出于安全考虑，git用户不允许ssh登录，修改配置文件/etc/passwd

![image10](/images/posts/CreateGit/10.jpg)

将

	git:x:1001:1001:,,,:/home/git:/bin/bash
	
改为

	git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell
	
试着再用命令行登录git用户，发现已经不能登录了

![image11](/images/posts/CreateGit/11.jpg)

本地克隆仓库

在命令行输入命令

	git clone git@172.16.202.129:/srv/git/demo.git

可以看到刚刚在服务器创建的裸仓库已经clone到本地了

![image12](/images/posts/CreateGit/12.jpg)

试着在demo目录下创建一个文本文件，然后提交到服务器

![image13](/images/posts/CreateGit/13.jpg)


登录服务器，再创建个用户

	sudo adduser moshuqi
	
然后用这个用户进行登录，在用户的根目录下新建个文件夹code，专门用来保存代码

在code目录下将仓库拷贝

	git clone /srv/git/demo.git/
	
拷贝完成后即可看到我们之前在本地提交的文本文件

![image14](/images/posts/CreateGit/14.jpg)