---
layout: post
title:  水波表现进度的动画效果实现
category: "iOS"
---



最近有一个需求，用小球表示进度，小球里水的高度表示进度完成的比例，设置比例参数时，水面会有一个从0开始波动上升的过程，水面上升到指定高度后，水波慢慢平缓最后静止。

<br>

网上看了一些示例，大体上有两种实现方式：

1. 切一张波浪形的图片，进行不断循环的位置变化的动画
2. 绘制波浪形的线条，并进行线条变化的重绘更新

需求的实现采用的是第二种思路，通过**CAShapeLayer**绘制波形曲线，并不断改变垂直位置，来达到水面波动并上升的动画效果。

####代码实现：

自定义一个**UIView**,命名为**YSWaterWaveView**

YSWaterWaveView.m 实现文件中变量的声明：


	@interface YSWaterWaveView ()

	@property (nonatomic, strong) CADisplayLink *displayLink;

	@property (nonatomic, strong) CAShapeLayer *waveLayer;
	@property (nonatomic, strong) CAGradientLayer

	...

**CADisplayLink**是一个和屏幕刷新率同步定时器类，通过创建一个**CADisplayLink**类displayLink，把它添加到**runloop**，并给它提供一个方法，在屏幕刷新时调用


**waveLayer**用来绘制波形曲线，并作为**gradientLayer**的**mask**，**gradientLayer**用来呈现背景的渐变色，若不需要渐变色，可以只用**waveLayer**来实现效果

<br>
  

	@property (nonatomic, strong) NSArray *colors;  
	@property (nonatomic, assign) CGFloat percent;  
	
	...

**colors**为渐变色需要用到的颜色数组，**percent**为整个小球的进度比例



	@property (nonatomic, assign) CGFloat waveAmplitude;   
	@property (nonatomic, assign) CGFloat waveCycle;
	@property (nonatomic, assign) CGFloat offsetX;   
	@property (nonatomic, assign) CGFloat currentWavePointY; 
	
	...        
	
绘制波形的变量定义，使用波形曲线**y=Asin(ωx+φ)+k**进行绘制

**waveAmplitude**，波纹振幅，A

**waveCycle**波纹周期，T = 2π/ω

**offsetX**，波浪x位移，φ

**currentWavePointY**，当前波浪高度，k



	@property (nonatomic, assign) CGFloat waveSpeed;      
	@property (nonatomic, assign) CGFloat waveGrowth;    
	... 
	
**waveSpeed**波纹速度，用来累加到相位φ上，达到波纹水平移动的效果

**waveGrowth**波纹上升速度，累加到k上，达到波浪高度上升的效果



	@property (nonatomic, assign) BOOL bWaveFinished;
	@property (nonatomic, assign) BOOL increase;
	@property (nonatomic, assign) CGFloat variable;

	@end

其他的一些用来标记的变量

...

<未完待续。>